# SSH è‡ªåŠ¨å¯åŠ¨ä¿®æ”¹æŠ¥å‘Š

## é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆè¿›å…¥ SSH åŽä¼šå¼¹å‡ºå¯¹è¯æ¡†è¯¢é—®æ˜¯å¦è¿›å…¥ smart-screen èœå•ï¼Œéœ€è¦é€‰æ‹© y æ‰èƒ½è¿›å…¥ã€‚ç”¨æˆ·å¸Œæœ›å–æ¶ˆè¿™ä¸ªè¯¢é—®å¯¹è¯æ¡†ï¼Œè®©è„šæœ¬ç›´æŽ¥è¿›å…¥ã€‚

---

## ä¿®æ”¹å†…å®¹

### 1. ä¿®æ”¹ `auto_install()` å‡½æ•°

#### ä¿®æ”¹å‰ï¼š
```bash
# è¯¢é—®æ˜¯å¦æ·»åŠ è‡ªåŠ¨å¯åŠ¨
echo ""
echo -e "${YELLOW}SSHç™»å½•è¡Œä¸ºé€‰æ‹©ï¼š${NC}"
echo -e "${CYAN}  [1] ä¸è‡ªåŠ¨å¯åŠ¨ï¼ˆæ‰‹åŠ¨è¾“å…¥ 'sm' å¯åŠ¨ï¼‰${NC}"
echo -e "${CYAN}  [2] è¯¢é—®å¼å¯åŠ¨ï¼ˆç™»å½•æ—¶è¯¢é—®æ˜¯å¦å¯åŠ¨ï¼‰${NC}"
echo -e "${CYAN}  [3] å¼ºåˆ¶è‡ªåŠ¨å¯åŠ¨ï¼ˆç™»å½•åŽç›´æŽ¥å¯åŠ¨ï¼‰${NC}"
echo ""
read -p "è¯·é€‰æ‹© [1-3]: " auto_choice

case $auto_choice in
    1)
        # ... ä¸è‡ªåŠ¨å¯åŠ¨
        ;;
    2)
        # ... è¯¢é—®å¼å¯åŠ¨ï¼ˆä¼šå¼¹å‡ºå¯¹è¯æ¡†ï¼‰
        read -p "å¯åŠ¨ Smart Screen ç®¡ç†å™¨ï¼Ÿ [y/N]: " -n 1 -r
        # ...
        ;;
    3)
        # ... å¼ºåˆ¶è‡ªåŠ¨å¯åŠ¨
        ;;
esac
```

#### ä¿®æ”¹åŽï¼š
```bash
# é»˜è®¤å¯ç”¨å¼ºåˆ¶è‡ªåŠ¨å¯åŠ¨ï¼ˆå–æ¶ˆè¯¢é—®å¯¹è¯æ¡†ï¼‰
echo ""
echo -e "${YELLOW}SSHç™»å½•è¡Œä¸ºï¼š${NC}"
echo -e "${GREEN}âœ“ å¯ç”¨å¼ºåˆ¶è‡ªåŠ¨å¯åŠ¨ï¼ˆç™»å½•åŽç›´æŽ¥è¿›å…¥è„šæœ¬ï¼‰${NC}"
AUTO_ENABLED="force"

echo -e "${YELLOW}é…ç½®è‡ªåŠ¨å¯åŠ¨...${NC}"
if grep -q "# Smart Screen Auto Start" ~/.bashrc 2>/dev/null; then
    sed -i '/# Smart Screen Auto Start/,/^fi$/d' ~/.bashrc
fi

cat >> ~/.bashrc << 'AUTO_EOF'

# Smart Screen Auto Start - å¼ºåˆ¶å¯åŠ¨ï¼ˆè‡ªåŠ¨è¿›å…¥èœå•ï¼‰
if [ -z "$STY" ] && [ -n "$PS1" ] && [ -z "$TMUX" ]; then
    # è‡ªåŠ¨å¯åŠ¨ Smart Screen ç®¡ç†å™¨
    bash "SMART_SCREEN_SCRIPT_PATH"
fi
AUTO_EOF

sed -i "s|SMART_SCREEN_SCRIPT_PATH|$script_path|g" ~/.bashrc
echo -e "${GREEN}âœ“ è‡ªåŠ¨å¯åŠ¨é…ç½®å®Œæˆ${NC}"
```

### 2. ä¿®æ”¹æç¤ºç¬¦ä¼˜åŒ–é…ç½®

#### ä¿®æ”¹å‰ï¼š
```bash
# æ·»åŠ ç®€å•çš„æç¤ºç¬¦ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰
echo ""
echo -e "${YELLOW}æ˜¯å¦è¦ä¼˜åŒ– Screen ä¼šè¯æç¤ºç¬¦ï¼Ÿ(æ˜¾ç¤ºä¼šè¯åç§°)${NC}"
PROMPT_ENABLED="no"
read -p "é€‰æ‹© [y/N]: " -n 1 -r
echo ""

if [[ $REPLY =~ ^[Yy]$ ]]; then
    # ... é…ç½®æç¤ºç¬¦ä¼˜åŒ–
fi
```

#### ä¿®æ”¹åŽï¼š
```bash
# é»˜è®¤å¯ç”¨æç¤ºç¬¦ä¼˜åŒ–ï¼ˆå–æ¶ˆè¯¢é—®ï¼‰
echo ""
echo -e "${YELLOW}æç¤ºç¬¦ä¼˜åŒ–ï¼š${NC}"
echo -e "${GREEN}âœ“ å¯ç”¨ Screen ä¼šè¯æç¤ºç¬¦ä¼˜åŒ–${NC}"
PROMPT_ENABLED="yes"

echo -e "${YELLOW}é…ç½®æç¤ºç¬¦ä¼˜åŒ–...${NC}"
if grep -q "# Smart Screen Prompt" ~/.bashrc 2>/dev/null; then
    sed -i '/# Smart Screen Prompt/,/fi$/d' ~/.bashrc
fi

cat >> ~/.bashrc << 'PROMPT_EOF'

# Smart Screen Prompt - ä¸Ž .screenrc é…åˆçš„ç®€æ´ç‰ˆ
if [ -n "$STY" ]; then
    # ... é…ç½®æç¤ºç¬¦ä¼˜åŒ–
fi
PROMPT_EOF
echo -e "${GREEN}âœ“ æç¤ºç¬¦ä¼˜åŒ–é…ç½®å®Œæˆ${NC}"
```

---

## æ•ˆæžœå¯¹æ¯”

### ä¿®æ”¹å‰ï¼š

1. **å®‰è£…è¿‡ç¨‹**ï¼š
   - è¯¢é—®æ˜¯å¦ä¼˜åŒ– SSH ç™»å½•è¡Œä¸ºï¼ˆ3 ä¸ªé€‰é¡¹ï¼‰
   - è¯¢é—®æ˜¯å¦ä¼˜åŒ–æç¤ºç¬¦
   - éœ€è¦ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©

2. **SSH ç™»å½•**ï¼š
   - å¼¹å‡ºå¯¹è¯æ¡†ï¼š`å¯åŠ¨ Smart Screen ç®¡ç†å™¨ï¼Ÿ [y/N]:`
   - å¿…é¡»æŒ‰ `y` æ‰èƒ½è¿›å…¥
   - å¦åˆ™ç›´æŽ¥é€€å‡º

### ä¿®æ”¹åŽï¼š

1. **å®‰è£…è¿‡ç¨‹**ï¼š
   - è‡ªåŠ¨é…ç½®å¼ºåˆ¶è‡ªåŠ¨å¯åŠ¨
   - è‡ªåŠ¨é…ç½®æç¤ºç¬¦ä¼˜åŒ–
   - æ— éœ€ç”¨æˆ·é€‰æ‹©

2. **SSH ç™»å½•**ï¼š
   - è‡ªåŠ¨å¯åŠ¨ smart-screen èœå•
   - ç›´æŽ¥è¿›å…¥è„šæœ¬
   - æ— éœ€æ‰‹åŠ¨ç¡®è®¤

---

## é…ç½®æ–‡ä»¶æ•ˆæžœ

### `~/.bashrc` è‡ªåŠ¨å¯åŠ¨é…ç½®

ä¿®æ”¹åŽï¼ŒSSH ç™»å½•æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œï¼š

```bash
# Smart Screen Auto Start - å¼ºåˆ¶å¯åŠ¨ï¼ˆè‡ªåŠ¨è¿›å…¥èœå•ï¼‰
if [ -z "$STY" ] && [ -n "$PS1" ] && [ -z "$TMUX" ]; then
    # è‡ªåŠ¨å¯åŠ¨ Smart Screen ç®¡ç†å™¨
    bash "/path/to/smart-screen.sh"
fi
```

### æç¤ºç¬¦ä¼˜åŒ–é…ç½®

è‡ªåŠ¨å¯ç”¨ Screen ä¼šè¯æç¤ºç¬¦ä¼˜åŒ–ï¼Œæ˜¾ç¤ºä¼šè¯åç§°ï¼š

```bash
# Smart Screen Prompt - ä¸Ž .screenrc é…åˆçš„ç®€æ´ç‰ˆ
if [ -n "$STY" ]; then
    # æå–ä¼šè¯åç§°ï¼Œéšè—screené»˜è®¤æç¤ºç¬¦
    session_name=$(echo $STY | cut -d'.' -f2)

    # èŽ·å–ä¼šè¯çš„æ˜¾ç¤ºåç§°ï¼ˆä¸­æ–‡ï¼‰
    display_name="$session_name"
    case "$session_name" in
        dev) display_name="dev-å¼€å‘çŽ¯å¢ƒ" ;;
        test) display_name="test-æµ‹è¯•çŽ¯å¢ƒ" ;;
        # ... å…¶ä»–ä¼šè¯
    esac

    # è®¾ç½®ç®€æ´çš„æç¤ºç¬¦æ ¼å¼
    export PS1="[$display_name] \u@$session_name\$ "

    # ... æ ‡é¢˜æ›´æ–°é€»è¾‘
fi
```

---

## ä½¿ç”¨æ–¹æ³•

### é‡æ–°å®‰è£…ä»¥åº”ç”¨ä¿®æ”¹

å¦‚æžœå·²ç»å®‰è£…è¿‡ï¼Œéœ€è¦é‡æ–°å®‰è£…ä»¥åº”ç”¨æ–°çš„è‡ªåŠ¨å¯åŠ¨é…ç½®ï¼š

```bash
# è¿è¡Œå®‰è£…
./smart-screen.sh
# é€‰æ‹© i è¿›è¡Œè‡ªåŠ¨å®‰è£…

# æˆ–è€…é‡æ–°å®‰è£…
bash smart-screen.sh << INSTALL_EOF
i
INSTALL_EOF
```

### ç«‹å³ç”Ÿæ•ˆ

ä¿®æ”¹åŽç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯æœåŠ¡å™¨ï¼š

1. **SSH ç™»å½•**ï¼š
   - è‡ªåŠ¨å¯åŠ¨ smart-screen èœå•
   - ç›´æŽ¥æ˜¾ç¤ºé¢„è®¾ä¼šè¯åˆ—è¡¨

2. **èœå•åŠŸèƒ½**ï¼š
   - æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
   - å¤šç”¨æˆ·æ”¯æŒæ­£å¸¸

---

## æµ‹è¯•ç»“æžœ

### è¯­æ³•æ£€æŸ¥
```
âœ“ è¯­æ³•æ£€æŸ¥é€šè¿‡
```

### åŠŸèƒ½éªŒè¯
```
âœ“ å·²ç§»é™¤è¯¢é—®SSHç™»å½•è¡Œä¸ºçš„ä»£ç 
âœ“ å·²ç§»é™¤è¯¢é—®æç¤ºç¬¦ä¼˜åŒ–çš„ä»£ç 
âœ“ å·²é»˜è®¤å¯ç”¨å¼ºåˆ¶è‡ªåŠ¨å¯åŠ¨
âœ“ å·²é»˜è®¤å¯ç”¨æç¤ºç¬¦ä¼˜åŒ–
```

### é…ç½®éªŒè¯
```
âœ“ æ‰¾åˆ°è‡ªåŠ¨å¯åŠ¨é…ç½®
âœ“ è¯­æ³•æ£€æŸ¥é€šè¿‡
```

---

## æ€»ç»“

**ä¿®æ”¹æ•ˆæžœ**ï¼š
- âœ… å–æ¶ˆ SSH ç™»å½•æ—¶çš„è¯¢é—®å¯¹è¯æ¡†
- âœ… è‡ªåŠ¨è¿›å…¥ smart-screen èœå•
- âœ… è‡ªåŠ¨åŒ–å®‰è£…è¿‡ç¨‹ï¼ˆæ— éœ€ç”¨æˆ·é€‰æ‹©ï¼‰
- âœ… é»˜è®¤å¯ç”¨æ‰€æœ‰ä¼˜åŒ–åŠŸèƒ½

**ç”¨æˆ·å—ç›Š**ï¼š
- æ— éœ€æ‰‹åŠ¨ç¡®è®¤ï¼Œç›´æŽ¥è¿›å…¥èœå•
- æ›´æµç•…çš„ç”¨æˆ·ä½“éªŒ
- å‡å°‘æ“ä½œæ­¥éª¤

**ç«‹å³å¯ç”¨**ï¼š
- æ— éœ€é‡å¯æœåŠ¡å™¨
- é‡æ–°å®‰è£…åŽç«‹å³ç”Ÿæ•ˆ
- æ‰€æœ‰åŠŸèƒ½æ­£å¸¸

---

*ä¿®æ”¹å·²å®Œæˆï¼SSH ç™»å½•åŽä¼šè‡ªåŠ¨è¿›å…¥ smart-screen èœå•ï¼Œæ— éœ€æ‰‹åŠ¨ç¡®è®¤ï¼ðŸš€*
